<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Big Five äººæ ¼ç‰¹è´¨æµ‹è¯„</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        /* Header */
        .header {
            background: white;
            border-radius: 16px;
            padding: 32px;
            margin-bottom: 24px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
            text-align: center;
        }

        .header h1 {
            font-size: 2rem;
            color: #202123;
            margin-bottom: 8px;
        }

        .header p {
            color: #6b7280;
            font-size: 1rem;
        }

        /* Language Switch */
        .lang-switch {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-top: 20px;
        }

        .lang-btn {
            padding: 10px 24px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .lang-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: transparent;
        }

        .lang-btn:hover:not(.active) {
            background: #f0f0ff;
        }

        /* Instructions */
        .instructions {
            background: white;
            padding: 24px;
            border-radius: 12px;
            margin-bottom: 24px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .instructions h2 {
            font-size: 1.1rem;
            color: #202123;
            margin-bottom: 12px;
        }

        .instructions p {
            color: #6b7280;
            font-size: 0.95rem;
            line-height: 1.6;
        }

        /* Progress */
        .progress-container {
            position: sticky;
            top: 10px;
            background: white;
            padding: 16px 24px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            z-index: 100;
        }

        .progress-bar {
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 4px;
            transition: width 0.3s ease;
            width: 0%;
        }

        .progress-text {
            text-align: center;
            margin-top: 8px;
            color: #6b7280;
            font-size: 0.9rem;
        }

        /* Question Card */
        .question-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .question-card.answered {
            border-color: #10b981;
        }

        .question-number {
            font-size: 0.85rem;
            color: #667eea;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .question-text {
            font-size: 1.1rem;
            color: #202123;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        /* Rating Options */
        .rating-options {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .rating-option {
            flex: 1;
            min-width: 80px;
        }

        .rating-option input {
            display: none;
        }

        .rating-option label {
            display: block;
            padding: 12px 8px;
            background: #f3f4f6;
            border: 2px solid transparent;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.8rem;
            color: #6b7280;
            text-align: center;
        }

        .rating-option label:hover {
            background: #e5e7eb;
            border-color: #667eea;
        }

        .rating-option input:checked + label {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: transparent;
            color: white;
            font-weight: 600;
        }

        /* Submit Button */
        .submit-container {
            text-align: center;
            margin: 32px 0;
        }

        .submit-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 16px 48px;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4);
        }

        .submit-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(102, 126, 234, 0.5);
        }

        .submit-btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            box-shadow: none;
        }

        /* Results Section */
        .results-section {
            display: none;
        }

        .results-header {
            background: white;
            border-radius: 16px;
            padding: 32px;
            margin-bottom: 24px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
            text-align: center;
        }

        .results-header h2 {
            font-size: 1.8rem;
            color: #202123;
            margin-bottom: 8px;
        }

        /* Dimension Card */
        .dimension-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .dimension-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .dimension-name {
            font-size: 1.1rem;
            font-weight: 600;
            color: #202123;
        }

        .dimension-score {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .dimension-bar {
            height: 10px;
            background: #e5e7eb;
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 16px;
        }

        .dimension-fill {
            height: 100%;
            border-radius: 5px;
            transition: width 1s ease;
        }

        .dimension-level {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 600;
            color: white;
            margin-bottom: 12px;
        }

        .dimension-description {
            color: #6b7280;
            font-size: 0.95rem;
            line-height: 1.6;
        }

        /* Dimension Colors */
        .extraversion .dimension-fill,
        .extraversion .dimension-level { background: #ef4444; }
        .extraversion .dimension-score { color: #ef4444; }

        .agreeableness .dimension-fill,
        .agreeableness .dimension-level { background: #14b8a6; }
        .agreeableness .dimension-score { color: #14b8a6; }

        .conscientiousness .dimension-fill,
        .conscientiousness .dimension-level { background: #f59e0b; }
        .conscientiousness .dimension-score { color: #f59e0b; }

        .stability .dimension-fill,
        .stability .dimension-level { background: #22c55e; }
        .stability .dimension-score { color: #22c55e; }

        .intellect .dimension-fill,
        .intellect .dimension-level { background: #8b5cf6; }
        .intellect .dimension-score { color: #8b5cf6; }

        /* Summary Card */
        .summary-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-top: 24px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .summary-card h3 {
            font-size: 1.2rem;
            color: #202123;
            margin-bottom: 16px;
        }

        .summary-card p {
            color: #6b7280;
            line-height: 1.7;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 16px;
            margin-top: 32px;
            flex-wrap: wrap;
        }

        .back-btn {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
            padding: 14px 32px;
            font-size: 1rem;
            font-weight: 600;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            background: #667eea;
            color: white;
        }

        .restart-btn {
            background: transparent;
            color: #6b7280;
            border: 2px solid #e5e7eb;
            padding: 14px 32px;
            font-size: 1rem;
            font-weight: 600;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .restart-btn:hover {
            border-color: #667eea;
            color: #667eea;
        }

        /* Saving indicator */
        .saving-indicator {
            display: none;
            align-items: center;
            justify-content: center;
            gap: 8px;
            color: #667eea;
            margin-top: 16px;
        }

        .saving-indicator.show {
            display: flex;
        }

        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid #667eea;
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .save-success {
            color: #10b981;
        }

        /* Responsive */
        @media (max-width: 600px) {
            .header h1 { font-size: 1.5rem; }
            .rating-options { flex-direction: column; }
            .rating-option { min-width: 100%; }
            .action-buttons { flex-direction: column; }
            .back-btn, .restart-btn { width: 100%; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Assessment Section -->
        <div class="assessment-section" id="assessmentSection">
            <div class="header">
                <h1 id="titleText">ğŸ§  Big Five äººæ ¼ç‰¹è´¨æµ‹è¯„</h1>
                <p id="subtitleText">åŸºäº IPIP é‡è¡¨çš„äº”å› ç´ äººæ ¼æ¨¡å‹è¯„ä¼°</p>
                
                <div class="lang-switch">
                    <button class="lang-btn active" id="langZh" onclick="switchLanguage('zh')">ä¸­æ–‡</button>
                    <button class="lang-btn" id="langEn" onclick="switchLanguage('en')">English</button>
                </div>
            </div>

            <div class="instructions">
                <h2 id="instructionTitle">ğŸ“‹ æµ‹è¯„è¯´æ˜</h2>
                <p id="instructionText">è¯·æ ¹æ®ä½ ç›®å‰çš„çœŸå®çŠ¶æ€ä½œç­”ï¼Œè€Œéä½ æœŸæœ›æˆä¸ºçš„æ ·å­ã€‚å°†è‡ªå·±ä¸åŒæ€§åˆ«ã€åŒé¾„äººè¿›è¡Œæ¯”è¾ƒï¼Œè¯šå®åœ°è¯„ä¼°æ¯é¡¹æè¿°å¯¹ä½ çš„å‡†ç¡®ç¨‹åº¦ã€‚æœ¬æµ‹è¯„å…±50é“é¢˜ï¼Œå¤§çº¦éœ€è¦5-8åˆ†é’Ÿå®Œæˆã€‚</p>
            </div>

            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-text"><span id="answeredCount">0</span> / 50 <span id="progressLabel">é¢˜å·²å®Œæˆ</span></div>
            </div>

            <div id="questionsContainer"></div>

            <div class="submit-container">
                <button class="submit-btn" id="submitBtn" disabled onclick="calculateResults()">
                    <span id="submitText">æŸ¥çœ‹æˆ‘çš„äººæ ¼ç‰¹è´¨</span>
                </button>
            </div>
        </div>

        <!-- Results Section -->
        <div class="results-section" id="resultsSection">
            <div class="results-header">
                <h2 id="resultsTitle">ğŸ¯ ä½ çš„äººæ ¼ç‰¹è´¨è½®å»“</h2>
                <p id="resultsSubtitle" style="color: #6b7280;">ä»¥ä¸‹æ˜¯ä½ åœ¨äº”å¤§äººæ ¼ç»´åº¦ä¸Šçš„å¾—åˆ†ä¸è§£è¯»</p>
            </div>

            <div id="resultsContainer"></div>

            <div class="summary-card" id="summaryCard"></div>

            <div class="saving-indicator" id="savingIndicator">
                <div class="spinner"></div>
                <span id="savingText">æ­£åœ¨ä¿å­˜ç»“æœ...</span>
            </div>

            <div class="action-buttons">
                <button class="back-btn" onclick="goBack()">
                    <span id="backBtnText">è¿”å›å­¦ä¹ åŠ©æ‰‹</span>
                </button>
                <button class="restart-btn" onclick="restartAssessment()">
                    <span id="restartBtnText">é‡æ–°æµ‹è¯„</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        // Current language
        let currentLang = 'zh';
        
        // Get student info from sessionStorage
        const studentId = sessionStorage.getItem('student_id');
        const studentGroup = sessionStorage.getItem('student_group');

        // Check login status
        window.onload = function() {
            if (!studentId) {
                alert('è¯·å…ˆç™»å½•');
                window.location.href = '/login';
                return;
            }
            initQuestions();
        };

        // Question Data - Bilingual
        const questions = [
            { id: 1, zh: "æˆ‘æ˜¯èšä¼šä¸­çš„æ´»è·ƒäººç‰©", en: "I am the life of the party", factor: "E", keyed: "+" },
            { id: 2, zh: "æˆ‘å¾ˆå°‘å…³å¿ƒä»–äººçš„æ„Ÿå—", en: "I feel little concern for others", factor: "A", keyed: "-" },
            { id: 3, zh: "æˆ‘æ€»æ˜¯åšå¥½å……åˆ†å‡†å¤‡", en: "I am always prepared", factor: "C", keyed: "+" },
            { id: 4, zh: "æˆ‘å®¹æ˜“æ„Ÿåˆ°å‹åŠ›", en: "I get stressed out easily", factor: "N", keyed: "-" },
            { id: 5, zh: "æˆ‘çš„è¯æ±‡é‡å¾ˆä¸°å¯Œ", en: "I have a rich vocabulary", factor: "O", keyed: "+" },
            { id: 6, zh: "æˆ‘ä¸å¤ªçˆ±è¯´è¯", en: "I don't talk a lot", factor: "E", keyed: "-" },
            { id: 7, zh: "æˆ‘å¯¹ä»–äººå¾ˆæ„Ÿå…´è¶£", en: "I am interested in people", factor: "A", keyed: "+" },
            { id: 8, zh: "æˆ‘ç»å¸¸æŠŠä¸œè¥¿ä¹±æ”¾", en: "I leave my belongings around", factor: "C", keyed: "-" },
            { id: 9, zh: "æˆ‘å¤§å¤šæ•°æ—¶å€™éƒ½å¾ˆæ”¾æ¾", en: "I am relaxed most of the time", factor: "N", keyed: "+" },
            { id: 10, zh: "æˆ‘éš¾ä»¥ç†è§£æŠ½è±¡æ¦‚å¿µ", en: "I have difficulty understanding abstract ideas", factor: "O", keyed: "-" },
            { id: 11, zh: "æˆ‘åœ¨äººç¾¤ä¸­æ„Ÿåˆ°è‡ªåœ¨", en: "I feel comfortable around people", factor: "E", keyed: "+" },
            { id: 12, zh: "æˆ‘ä¼šä¾®è¾±ä»–äºº", en: "I insult people", factor: "A", keyed: "-" },
            { id: 13, zh: "æˆ‘æ³¨é‡ç»†èŠ‚", en: "I pay attention to details", factor: "C", keyed: "+" },
            { id: 14, zh: "æˆ‘ç»å¸¸æ‹…å¿ƒäº‹æƒ…", en: "I worry about things", factor: "N", keyed: "-" },
            { id: 15, zh: "æˆ‘æœ‰ä¸°å¯Œçš„æƒ³è±¡åŠ›", en: "I have a vivid imagination", factor: "O", keyed: "+" },
            { id: 16, zh: "æˆ‘å–œæ¬¢å¾…åœ¨å¹•å", en: "I keep in the background", factor: "E", keyed: "-" },
            { id: 17, zh: "æˆ‘èƒ½æ„ŸåŒèº«å—ä»–äººçš„æƒ…ç»ª", en: "I sympathize with others' feelings", factor: "A", keyed: "+" },
            { id: 18, zh: "æˆ‘ç»å¸¸æŠŠäº‹æƒ…æç ¸", en: "I make a mess of things", factor: "C", keyed: "-" },
            { id: 19, zh: "æˆ‘å¾ˆå°‘æ„Ÿåˆ°å¿§éƒ", en: "I seldom feel blue", factor: "N", keyed: "+" },
            { id: 20, zh: "æˆ‘å¯¹æŠ½è±¡æ¦‚å¿µä¸æ„Ÿå…´è¶£", en: "I am not interested in abstract ideas", factor: "O", keyed: "-" },
            { id: 21, zh: "æˆ‘ä¸»åŠ¨å‘èµ·äº¤è°ˆ", en: "I start conversations", factor: "E", keyed: "+" },
            { id: 22, zh: "æˆ‘å¯¹ä»–äººçš„é—®é¢˜ä¸æ„Ÿå…´è¶£", en: "I am not interested in other people's problems", factor: "A", keyed: "-" },
            { id: 23, zh: "æˆ‘ä¼šç«‹å³å®Œæˆä»»åŠ¡", en: "I get chores done right away", factor: "C", keyed: "+" },
            { id: 24, zh: "æˆ‘å¾ˆå®¹æ˜“å—åˆ°æ‰“æ‰°", en: "I am easily disturbed", factor: "N", keyed: "-" },
            { id: 25, zh: "æˆ‘æœ‰å¾ˆæ£’çš„æƒ³æ³•", en: "I have excellent ideas", factor: "O", keyed: "+" },
            { id: 26, zh: "æˆ‘æ²¡ä»€ä¹ˆè¯è¦è¯´", en: "I have little to say", factor: "E", keyed: "-" },
            { id: 27, zh: "æˆ‘å¿ƒè‚ å¾ˆè½¯", en: "I have a soft heart", factor: "A", keyed: "+" },
            { id: 28, zh: "æˆ‘ç»å¸¸å¿˜è®°æŠŠä¸œè¥¿æ”¾å›åŸå¤„", en: "I often forget to put things back in their proper place", factor: "C", keyed: "-" },
            { id: 29, zh: "æˆ‘å¾ˆå®¹æ˜“å¿ƒçƒ¦æ„ä¹±", en: "I get upset easily", factor: "N", keyed: "-" },
            { id: 30, zh: "æˆ‘ç¼ºä¹æƒ³è±¡åŠ›", en: "I do not have a good imagination", factor: "O", keyed: "-" },
            { id: 31, zh: "æˆ‘åœ¨èšä¼šä¸Šä¼šå’Œå¾ˆå¤šäººäº¤è°ˆ", en: "I talk to a lot of different people at parties", factor: "E", keyed: "+" },
            { id: 32, zh: "æˆ‘å¯¹ä»–äººçœŸçš„ä¸æ„Ÿå…´è¶£", en: "I am not really interested in others", factor: "A", keyed: "-" },
            { id: 33, zh: "æˆ‘å–œæ¬¢ç§©åº", en: "I like order", factor: "C", keyed: "+" },
            { id: 34, zh: "æˆ‘çš„æƒ…ç»ªå˜åŒ–å¾ˆå¤§", en: "I change my mood a lot", factor: "N", keyed: "-" },
            { id: 35, zh: "æˆ‘èƒ½å¿«é€Ÿç†è§£äº‹ç‰©", en: "I am quick to understand things", factor: "O", keyed: "+" },
            { id: 36, zh: "æˆ‘ä¸å–œæ¬¢å¼•èµ·æ³¨æ„", en: "I don't like to draw attention to myself", factor: "E", keyed: "-" },
            { id: 37, zh: "æˆ‘æ„¿æ„èŠ±æ—¶é—´å¸®åŠ©ä»–äºº", en: "I take time out for others", factor: "A", keyed: "+" },
            { id: 38, zh: "æˆ‘é€ƒé¿è‡ªå·±çš„èŒè´£", en: "I shirk my duties", factor: "C", keyed: "-" },
            { id: 39, zh: "æˆ‘çš„æƒ…ç»ªç»å¸¸èµ·ä¼ä¸å®š", en: "I have frequent mood swings", factor: "N", keyed: "-" },
            { id: 40, zh: "æˆ‘ä½¿ç”¨å¤æ‚çš„è¯æ±‡", en: "I use difficult words", factor: "O", keyed: "+" },
            { id: 41, zh: "æˆ‘ä¸ä»‹æ„æˆä¸ºç„¦ç‚¹", en: "I don't mind being the center of attention", factor: "E", keyed: "+" },
            { id: 42, zh: "æˆ‘èƒ½æ„Ÿå—åˆ°ä»–äººçš„æƒ…ç»ª", en: "I feel others' emotions", factor: "A", keyed: "+" },
            { id: 43, zh: "æˆ‘éµå¾ªæ—¶é—´è¡¨", en: "I follow a schedule", factor: "C", keyed: "+" },
            { id: 44, zh: "æˆ‘å¾ˆå®¹æ˜“è¢«æ¿€æ€’", en: "I get irritated easily", factor: "N", keyed: "-" },
            { id: 45, zh: "æˆ‘ä¼šèŠ±æ—¶é—´æ€è€ƒäº‹æƒ…", en: "I spend time reflecting on things", factor: "O", keyed: "+" },
            { id: 46, zh: "æˆ‘åœ¨é™Œç”Ÿäººé¢å‰å¾ˆå®‰é™", en: "I am quiet around strangers", factor: "E", keyed: "-" },
            { id: 47, zh: "æˆ‘è®©äººæ„Ÿåˆ°è½»æ¾è‡ªåœ¨", en: "I make people feel at ease", factor: "A", keyed: "+" },
            { id: 48, zh: "æˆ‘å¯¹å·¥ä½œè¦æ±‚ä¸¥æ ¼", en: "I am exacting in my work", factor: "C", keyed: "+" },
            { id: 49, zh: "æˆ‘ç»å¸¸æ„Ÿåˆ°å¿§éƒ", en: "I often feel blue", factor: "N", keyed: "-" },
            { id: 50, zh: "æˆ‘æ»¡è„‘å­éƒ½æ˜¯æƒ³æ³•", en: "I am full of ideas", factor: "O", keyed: "+" }
        ];

        // Rating labels - Bilingual
        const ratingLabels = {
            zh: ["éå¸¸ä¸å‡†ç¡®", "æ¯”è¾ƒä¸å‡†ç¡®", "ä¸ç¡®å®š", "æ¯”è¾ƒå‡†ç¡®", "éå¸¸å‡†ç¡®"],
            en: ["Very Inaccurate", "Moderately Inaccurate", "Neutral", "Moderately Accurate", "Very Accurate"]
        };

        // Factor info - Bilingual
        const factorInfo = {
            E: {
                zh: {
                    name: "å¤–å‘æ€§ (Extraversion)",
                    highDesc: "ä½ å€¾å‘äºå¤–å‘ã€çƒ­æƒ…ï¼Œå–„äºç¤¾äº¤äº’åŠ¨ã€‚ä½ ä»ä¸ä»–äººçš„äº¤å¾€ä¸­è·å¾—èƒ½é‡ï¼Œå–œæ¬¢æˆä¸ºå…³æ³¨çš„ç„¦ç‚¹ã€‚",
                    midDesc: "ä½ åœ¨ç¤¾äº¤æ–¹é¢æ¯”è¾ƒå¹³è¡¡ï¼Œèƒ½å¤Ÿé€‚åº”ä¸åŒçš„ç¤¾äº¤åœºåˆã€‚æ—¢èƒ½äº«å—ç¤¾äº¤æ´»åŠ¨ï¼Œä¹Ÿéœ€è¦ç‹¬å¤„æ—¶é—´ã€‚",
                    lowDesc: "ä½ å€¾å‘äºå†…æ•›ã€å®‰é™ï¼Œåå¥½ç‹¬å¤„æˆ–å°ç¾¤ä½“äº’åŠ¨ã€‚ä½ ä»ç‹¬å¤„ä¸­è·å¾—èƒ½é‡ã€‚"
                },
                en: {
                    name: "Extraversion",
                    highDesc: "You tend to be outgoing and enthusiastic, enjoying social interactions. You gain energy from being with others.",
                    midDesc: "You are balanced in social situations, adapting well to different contexts. You enjoy both socializing and solitude.",
                    lowDesc: "You tend to be reserved and quiet, preferring solitude or small group interactions."
                },
                class: "extraversion"
            },
            A: {
                zh: {
                    name: "å®œäººæ€§ (Agreeableness)",
                    highDesc: "ä½ å¾…äººå‹å–„ã€å¯Œæœ‰åŒç†å¿ƒï¼Œé‡è§†ä¸ä»–äººçš„å’Œè°å…³ç³»ã€‚ä½ ä¹äºåŠ©äººï¼Œå–„äºç†è§£ä»–äººæ„Ÿå—ã€‚",
                    midDesc: "ä½ åœ¨äººé™…äº’åŠ¨ä¸­ä¿æŒå¹³è¡¡ï¼Œæ—¢èƒ½ä½“è°…ä»–äººï¼Œä¹Ÿèƒ½åšæŒè‡ªå·±çš„ç«‹åœºã€‚",
                    lowDesc: "ä½ å€¾å‘äºæ›´åŠ ç›´æ¥å’Œç«äº‰æ€§ï¼Œé‡è§†ç‹¬ç«‹æ€è€ƒï¼Œå¯èƒ½æ›´å…³æ³¨ä»»åŠ¡å®Œæˆã€‚"
                },
                en: {
                    name: "Agreeableness",
                    highDesc: "You are friendly and empathetic, valuing harmonious relationships. You are helpful and understanding.",
                    midDesc: "You balance consideration for others with asserting your own position.",
                    lowDesc: "You tend to be more direct and competitive, valuing independent thinking."
                },
                class: "agreeableness"
            },
            C: {
                zh: {
                    name: "å°½è´£æ€§ (Conscientiousness)",
                    highDesc: "ä½ åšäº‹æœ‰æ¡ç†ã€è‡ªå¾‹æ€§å¼ºï¼Œæ³¨é‡ç›®æ ‡å’Œè®¡åˆ’ã€‚ä½ å¯é ã€å‹¤å¥‹ï¼Œè¿½æ±‚é«˜æ ‡å‡†ã€‚",
                    midDesc: "ä½ åœ¨ç»„ç»‡æ€§å’Œçµæ´»æ€§ä¹‹é—´ä¿æŒå¹³è¡¡ã€‚ä½ èƒ½å¤ŸæŒ‰è®¡åˆ’è¡Œäº‹ï¼Œä½†ä¹Ÿèƒ½é€‚åº”å˜åŒ–ã€‚",
                    lowDesc: "ä½ å€¾å‘äºçµæ´»ã€éšæ€§ï¼Œä¸å¤ªå–œæ¬¢ä¸¥æ ¼çš„è§„åˆ’å’Œç»“æ„ã€‚"
                },
                en: {
                    name: "Conscientiousness",
                    highDesc: "You are organized and self-disciplined, focusing on goals and plans. You are reliable and hardworking.",
                    midDesc: "You balance organization with flexibility, following plans while adapting to changes.",
                    lowDesc: "You tend to be flexible and spontaneous, preferring less rigid structures."
                },
                class: "conscientiousness"
            },
            N: {
                zh: {
                    name: "æƒ…ç»ªç¨³å®šæ€§ (Emotional Stability)",
                    highDesc: "ä½ æƒ…ç»ªç¨³å®šã€å†·é™ä»å®¹ï¼Œèƒ½å¤Ÿå¾ˆå¥½åœ°åº”å¯¹å‹åŠ›å’ŒæŒ‘æˆ˜ã€‚ä½ ä¸å®¹æ˜“ç„¦è™‘æˆ–æƒ…ç»ªæ³¢åŠ¨ã€‚",
                    midDesc: "ä½ çš„æƒ…ç»ªçŠ¶æ€æ¯”è¾ƒå¹³è¡¡ï¼Œå¤§å¤šæ•°æ—¶å€™èƒ½ä¿æŒç¨³å®šï¼Œä½†åœ¨å‹åŠ›ä¸‹ä¹Ÿä¼šæœ‰æ³¢åŠ¨ã€‚",
                    lowDesc: "ä½ å¯èƒ½æ¯”è¾ƒæ•æ„Ÿï¼Œå®¹æ˜“å—åˆ°æƒ…ç»ªå½±å“ã€‚å­¦ä¹ æƒ…ç»ªè°ƒèŠ‚æŠ€å·§å¯èƒ½å¯¹ä½ æœ‰å¸®åŠ©ã€‚"
                },
                en: {
                    name: "Emotional Stability",
                    highDesc: "You are emotionally stable and calm, handling stress and challenges well. You rarely feel anxious.",
                    midDesc: "Your emotional state is balanced, staying stable most of the time with occasional fluctuations.",
                    lowDesc: "You may be more sensitive and easily affected by emotions. Emotion regulation techniques might help."
                },
                class: "stability"
            },
            O: {
                zh: {
                    name: "å¼€æ”¾æ€§ (Openness/Intellect)",
                    highDesc: "ä½ æ€æƒ³å¼€æ”¾ã€å¯Œæœ‰åˆ›é€ åŠ›ï¼Œå¯¹æ–°äº‹ç‰©å……æ»¡å¥½å¥‡ã€‚ä½ å–œæ¬¢æ¢ç´¢æ–°æƒ³æ³•ï¼Œäº«å—æ™ºåŠ›æŒ‘æˆ˜ã€‚",
                    midDesc: "ä½ åœ¨ä¼ ç»Ÿä¸åˆ›æ–°ä¹‹é—´ä¿æŒå¹³è¡¡ã€‚ä½ èƒ½æ¥å—æ–°æƒ³æ³•ï¼ŒåŒæ—¶ä¹Ÿé‡è§†å®é™…æ–¹æ³•ã€‚",
                    lowDesc: "ä½ å€¾å‘äºåŠ¡å®ã€ä¼ ç»Ÿï¼Œåå¥½å…·ä½“å’Œç†Ÿæ‚‰çš„äº‹ç‰©ã€‚"
                },
                en: {
                    name: "Openness/Intellect",
                    highDesc: "You are open-minded and creative, curious about new things. You enjoy exploring ideas and intellectual challenges.",
                    midDesc: "You balance tradition with innovation, accepting new ideas while valuing practical methods.",
                    lowDesc: "You tend to be practical and traditional, preferring concrete and familiar things."
                },
                class: "intellect"
            }
        };

        // UI Text - Bilingual
        const uiText = {
            zh: {
                title: "ğŸ§  Big Five äººæ ¼ç‰¹è´¨æµ‹è¯„",
                subtitle: "åŸºäº IPIP é‡è¡¨çš„äº”å› ç´ äººæ ¼æ¨¡å‹è¯„ä¼°",
                instructionTitle: "ğŸ“‹ æµ‹è¯„è¯´æ˜",
                instructionText: "è¯·æ ¹æ®ä½ ç›®å‰çš„çœŸå®çŠ¶æ€ä½œç­”ï¼Œè€Œéä½ æœŸæœ›æˆä¸ºçš„æ ·å­ã€‚å°†è‡ªå·±ä¸åŒæ€§åˆ«ã€åŒé¾„äººè¿›è¡Œæ¯”è¾ƒï¼Œè¯šå®åœ°è¯„ä¼°æ¯é¡¹æè¿°å¯¹ä½ çš„å‡†ç¡®ç¨‹åº¦ã€‚æœ¬æµ‹è¯„å…±50é“é¢˜ï¼Œå¤§çº¦éœ€è¦5-8åˆ†é’Ÿå®Œæˆã€‚",
                progressLabel: "é¢˜å·²å®Œæˆ",
                questionPrefix: "ç¬¬",
                questionSuffix: "é¢˜",
                submitBtn: "æŸ¥çœ‹æˆ‘çš„äººæ ¼ç‰¹è´¨",
                resultsTitle: "ğŸ¯ ä½ çš„äººæ ¼ç‰¹è´¨è½®å»“",
                resultsSubtitle: "ä»¥ä¸‹æ˜¯ä½ åœ¨äº”å¤§äººæ ¼ç»´åº¦ä¸Šçš„å¾—åˆ†ä¸è§£è¯»",
                levelHigh: "é«˜",
                levelMid: "ä¸­",
                levelLow: "ä½",
                summaryTitle: "âœ¨ äººæ ¼ç‰¹è´¨æ€»ç»“",
                summaryTemplate: "åœ¨äº”å¤§äººæ ¼ç»´åº¦ä¸­ï¼Œä½ æœ€çªå‡ºçš„ç‰¹è´¨æ˜¯<strong>{highest}</strong>ï¼ˆå¾—åˆ† {highScore}ï¼‰ï¼Œè¿™æ„å‘³ç€ä½ åœ¨è¿™æ–¹é¢çš„è¡¨ç°æ˜æ˜¾é«˜äºå¹³å‡æ°´å¹³ã€‚ç›¸å¯¹è€Œè¨€ï¼Œä½ çš„<strong>{lowest}</strong>ï¼ˆå¾—åˆ† {lowScore}ï¼‰å¾—åˆ†è¾ƒä½ã€‚æ¯ç§äººæ ¼ç‰¹è´¨éƒ½æœ‰å…¶ç‹¬ç‰¹çš„ä¼˜åŠ¿ï¼Œæ²¡æœ‰å¥½åä¹‹åˆ†ã€‚",
                backBtn: "è¿”å›å­¦ä¹ åŠ©æ‰‹",
                restartBtn: "é‡æ–°æµ‹è¯„",
                savingText: "æ­£åœ¨ä¿å­˜ç»“æœ...",
                savedText: "ç»“æœå·²ä¿å­˜ âœ“"
            },
            en: {
                title: "ğŸ§  Big Five Personality Assessment",
                subtitle: "Five-Factor Model based on IPIP scales",
                instructionTitle: "ğŸ“‹ Instructions",
                instructionText: "Please answer based on how you are now, not how you wish to be. Compare yourself to others of your same gender and age. This assessment has 50 questions and takes about 5-8 minutes.",
                progressLabel: "completed",
                questionPrefix: "Question",
                questionSuffix: "",
                submitBtn: "View My Results",
                resultsTitle: "ğŸ¯ Your Personality Profile",
                resultsSubtitle: "Your scores and interpretations across the five personality dimensions",
                levelHigh: "High",
                levelMid: "Medium",
                levelLow: "Low",
                summaryTitle: "âœ¨ Personality Summary",
                summaryTemplate: "Among the five personality dimensions, your most prominent trait is <strong>{highest}</strong> (score: {highScore}), indicating above-average performance in this area. Relatively, your <strong>{lowest}</strong> (score: {lowScore}) is lower. Each personality trait has its unique strengths.",
                backBtn: "Back to Learning Assistant",
                restartBtn: "Retake Assessment",
                savingText: "Saving results...",
                savedText: "Results saved âœ“"
            }
        };

        let responses = {};

        // Switch language
        function switchLanguage(lang) {
            currentLang = lang;
            
            // Update language buttons
            document.getElementById('langZh').classList.toggle('active', lang === 'zh');
            document.getElementById('langEn').classList.toggle('active', lang === 'en');
            
            // Update UI text
            const t = uiText[lang];
            document.getElementById('titleText').textContent = t.title;
            document.getElementById('subtitleText').textContent = t.subtitle;
            document.getElementById('instructionTitle').textContent = t.instructionTitle;
            document.getElementById('instructionText').textContent = t.instructionText;
            document.getElementById('progressLabel').textContent = t.progressLabel;
            document.getElementById('submitText').textContent = t.submitBtn;
            document.getElementById('resultsTitle').textContent = t.resultsTitle;
            document.getElementById('resultsSubtitle').textContent = t.resultsSubtitle;
            document.getElementById('backBtnText').textContent = t.backBtn;
            document.getElementById('restartBtnText').textContent = t.restartBtn;
            document.getElementById('savingText').textContent = t.savingText;
            
            // Update questions
            updateQuestionTexts();
        }

        // Update question texts based on language
        function updateQuestionTexts() {
            const t = uiText[currentLang];
            questions.forEach((q, index) => {
                const card = document.getElementById(`card-${q.id}`);
                if (card) {
                    card.querySelector('.question-number').textContent = 
                        currentLang === 'zh' ? `${t.questionPrefix} ${index + 1} ${t.questionSuffix}` : `${t.questionPrefix} ${index + 1}`;
                    card.querySelector('.question-text').textContent = q[currentLang];
                    
                    // Update rating labels
                    const labels = card.querySelectorAll('.rating-option label');
                    labels.forEach((label, i) => {
                        label.textContent = ratingLabels[currentLang][i];
                    });
                }
            });
        }

        // Initialize questions
        function initQuestions() {
            const container = document.getElementById('questionsContainer');
            const t = uiText[currentLang];
            
            questions.forEach((q, index) => {
                const card = document.createElement('div');
                card.className = 'question-card';
                card.id = `card-${q.id}`;
                
                let optionsHTML = '<div class="rating-options">';
                for (let i = 1; i <= 5; i++) {
                    optionsHTML += `
                        <div class="rating-option">
                            <input type="radio" name="q${q.id}" id="q${q.id}_${i}" value="${i}" onchange="handleResponse(${q.id}, ${i})">
                            <label for="q${q.id}_${i}">${ratingLabels[currentLang][i-1]}</label>
                        </div>
                    `;
                }
                optionsHTML += '</div>';
                
                card.innerHTML = `
                    <div class="question-number">${t.questionPrefix} ${index + 1} ${t.questionSuffix}</div>
                    <div class="question-text">${q[currentLang]}</div>
                    ${optionsHTML}
                `;
                
                container.appendChild(card);
            });
        }

        // Handle response
        function handleResponse(questionId, value) {
            responses[questionId] = value;
            
            const card = document.getElementById(`card-${questionId}`);
            card.classList.add('answered');
            
            updateProgress();
        }

        // Update progress
        function updateProgress() {
            const answered = Object.keys(responses).length;
            const progress = (answered / 50) * 100;
            
            document.getElementById('progressFill').style.width = `${progress}%`;
            document.getElementById('answeredCount').textContent = answered;
            
            document.getElementById('submitBtn').disabled = answered < 50;
        }

        // Calculate results
        function calculateResults() {
            const scores = { E: 0, A: 0, C: 0, N: 0, O: 0 };
            
            questions.forEach(q => {
                let score = responses[q.id];
                
                // Reverse score for negatively keyed items
                if (q.keyed === '-') {
                    score = 6 - score;
                }
                
                scores[q.factor] += score;
            });

            // Convert to average (1-5 scale)
            for (let factor in scores) {
                scores[factor] = (scores[factor] / 10).toFixed(2);
            }

            displayResults(scores);
            saveResults(scores);
        }

        // Display results
        function displayResults(scores) {
            document.getElementById('assessmentSection').style.display = 'none';
            document.getElementById('resultsSection').style.display = 'block';
            
            const container = document.getElementById('resultsContainer');
            container.innerHTML = '';

            const factorOrder = ['E', 'A', 'C', 'N', 'O'];
            const t = uiText[currentLang];
            
            factorOrder.forEach(factor => {
                const info = factorInfo[factor];
                const langInfo = info[currentLang];
                const score = parseFloat(scores[factor]);
                const percentage = ((score - 1) / 4) * 100;
                
                let level, description;
                if (score >= 3.5) {
                    level = t.levelHigh;
                    description = langInfo.highDesc;
                } else if (score >= 2.5) {
                    level = t.levelMid;
                    description = langInfo.midDesc;
                } else {
                    level = t.levelLow;
                    description = langInfo.lowDesc;
                }

                const card = document.createElement('div');
                card.className = `dimension-card ${info.class}`;
                card.innerHTML = `
                    <div class="dimension-header">
                        <div class="dimension-name">${langInfo.name}</div>
                        <div class="dimension-score">${score}</div>
                    </div>
                    <div class="dimension-bar">
                        <div class="dimension-fill" style="width: 0%"></div>
                    </div>
                    <span class="dimension-level">${level}</span>
                    <div class="dimension-description">${description}</div>
                `;
                
                container.appendChild(card);
                
                // Animate the bar
                setTimeout(() => {
                    card.querySelector('.dimension-fill').style.width = `${percentage}%`;
                }, 100);
            });

            // Generate summary
            generateSummary(scores);
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Generate personality summary
        function generateSummary(scores) {
            const factors = Object.entries(scores)
                .map(([factor, score]) => ({ factor, score: parseFloat(score) }))
                .sort((a, b) => b.score - a.score);

            const highest = factors[0];
            const lowest = factors[factors.length - 1];

            const t = uiText[currentLang];
            const highestName = factorInfo[highest.factor][currentLang].name;
            const lowestName = factorInfo[lowest.factor][currentLang].name;

            const summaryCard = document.getElementById('summaryCard');
            const summaryText = t.summaryTemplate
                .replace('{highest}', highestName)
                .replace('{highScore}', highest.score)
                .replace('{lowest}', lowestName)
                .replace('{lowScore}', lowest.score);

            summaryCard.innerHTML = `
                <h3>${t.summaryTitle}</h3>
                <p>${summaryText}</p>
            `;
        }

        // Save results to backend
        async function saveResults(scores) {
            const indicator = document.getElementById('savingIndicator');
            const savingText = document.getElementById('savingText');
            const t = uiText[currentLang];
            
            indicator.classList.add('show');
            
            try {
                const response = await fetch('/api/personality/save', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        student_id: studentId,
                        scores: scores,
                        responses: responses,
                        language: currentLang,
                        completed_at: new Date().toISOString()
                    })
                });

                const data = await response.json();
                
                if (data.success) {
                    savingText.textContent = t.savedText;
                    savingText.classList.add('save-success');
                    indicator.querySelector('.spinner').style.display = 'none';
                } else {
                    throw new Error(data.error || 'Save failed');
                }
            } catch (error) {
                console.error('Save error:', error);
                savingText.textContent = currentLang === 'zh' ? 'ä¿å­˜å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•' : 'Save failed, please try again';
                savingText.style.color = '#ef4444';
            }
        }

        // Go back to chat
        function goBack() {
            window.location.href = '/';
        }

        // Restart assessment
        function restartAssessment() {
            responses = {};
            document.getElementById('resultsSection').style.display = 'none';
            document.getElementById('assessmentSection').style.display = 'block';
            
            // Reset saving indicator
            const indicator = document.getElementById('savingIndicator');
            const savingText = document.getElementById('savingText');
            indicator.classList.remove('show');
            savingText.classList.remove('save-success');
            savingText.style.color = '';
            indicator.querySelector('.spinner').style.display = 'block';
            
            // Reset all radio buttons
            document.querySelectorAll('input[type="radio"]').forEach(input => {
                input.checked = false;
            });
            
            // Reset card styles
            document.querySelectorAll('.question-card').forEach(card => {
                card.classList.remove('answered');
            });
            
            updateProgress();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    </script>
</body>
</html>